<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title> Global Warming Data </title>
<style>

    body {
      font-family: Verdana,Arial,sans-serif;
    }
    h2 {
      font-size: 1.2em;
      margin: 60px 0 5px 0;
    }
    .wrapper {
      width: 1200px;
      margin-left: auto;
      margin-right: auto;
    }
    .wrapper > div {
      margin: 10px 0;
    

    
  </style>
<h2> CO2 Emission across Counties from 1960 to 2010  </h2>

  
</head>
<body>
  <div class="wrapper">
   <h for="amount" >CO2 Emission for Year: </h>
   <input  id="amount", value= 1960 style="border:0; color:#f6931f; font-weight:bold; font-size:24px" />
   <link rel="stylesheet" href="d3.slider.css" />  
   <div  id="slider"></div>
	<div id="container1" style="position: relative; width: 80%; max-height: 450px;"></div>

   </div>

  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://d3js.org/topojson.v1.min.js"></script>
  <!-- I recommend you host this file on your own, since this will change without warning -->
  <script src="http://datamaps.github.io/scripts/datamaps.world.min.js?v=1"></script>
  <script src="http://datamaps.github.io/scripts/datamaps.world.min.js"></script>
  <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="d3.slider.js"></script>
<script>

var width = 960,
    height = 600;


var
color_q0 = 'rgb(198,219,239)',
color_q1 = 'rgb(158,202,225)',
color_q2 = 'rgb(107,174,214)',
color_q3 = 'rgb(66,146,198)',
color_q4 = 'rgb(33,113,181)',
color_q5 = 'rgb(8,81,156)',
color_q6 = 'rgb(8,48,107)',
colorScale = [
  color_q6,
  color_q5,
  color_q4,
  color_q3,
  color_q2,
  color_q1,
  color_q0
] // array used to generate color scale

var quantize = d3.scale.threshold()
.domain([0.38, 0.68, 0.97, 1.33, 1.91, 2.99, 17.14])
.range(d3.range(7).map(function(i) { return "q" + i; }));

var jsonMilExp = {};

var map = new Datamap({
  element: document.getElementById('container1'),
  projection: 'mercator',
  fills: {
    defaultFill: 'rgb(222,235,247)',
    // define colors for quantized scale
    q0: color_q0,
    q1: color_q1,
    q2: color_q2,
    q3: color_q3,
    q4: color_q4,
    q5: color_q5,
    q6: color_q6
  },
  data: jsonMilExp,
  geographyConfig: {
    popupTemplate: function(geo, data) {
if (data == null)
        return '<div class="hoverinfo"><strong>No data available for ' + geo.properties.name + '</strong></div>';
        return ['<div class="hoverinfo"><strong>', 
               geo.properties.name, 
           '<br/>Year: ' + data.Year, 
           //'<br/>CO2 Intensity: ' + Math.round(data.Tech*1000)/1000,
           '<br/>CO2 Intensity: ' + data.Tech,
           //'<br/>GDP: ' + Math.round(data.GDP*1000)/1000, 
           '<br/>GDP: ' + data.GDP,
                '</strong></div>'].join('');
               }
},
  responsive: true
});

var fullData = {
    1960: {},
    1961: {},
    1962: {},
    1963: {},
    1964: {},
    1965: {},
    1966: {},
    1967: {},
    1968: {},
    1969: {},
    1970: {},
    1971: {},
    1972: {},
    1973: {},
    1974: {},
    1975: {},
    1976: {},
    1977: {},
    1978: {},
    1979: {},
    1980: {},
    1981: {},
    1982: {},
    1983: {},
    1984: {},
    1985: {},
    1986: {},
    1987: {},
    1988: {},
    1989: {},
    1990: {},
    1991: {},
    1992: {},
    1993: {},
    1994: {},
    1995: {},
    1996: {},
    1997: {},
    1998: {},
    1999: {},
    2000: {},
    2001: {},
    2002: {},
    2003: {},
    2004: {},
    2005: {},
    2006: {},
    2007: {},
    2008: {},
    2009: {},
    2010: {}
};

var load_data = function(Year) {
    d3.csv("data_co2.csv", function (error, data) {
          data
            .forEach(function(d) {
                // create data for map
                fullData[d.Year][d.Isocode] = {
                  Iso: d.Isocode,
                  fillKey: quantize(d.Tech),
                  Year: +d.Year,
                  Tech: +d.Tech,
                  GDP: +d.GDP
                };
              });
            });   

    map.updateChoropleth(fullData[Year_tmp]);
//    update_data(Year);
};


var update_data = function(Year) {
    map.updateChoropleth(fullData[Year]);
};


 
//load_data(1960);
update_data(1960);

d3.select('#slider').call(d3.slider().axis(true).min(1960).max(2010).step(1).on("slide",function(evt,value){
	d3.select( "#amount" ).property("value", value);
}));

//d3.selectAll("input").on("change", function change() {
//    var Year = +this.value;
//    update_data(Year);
//});


// append the container for the legend
d3.select('svg')
  .append('g')
  .attr('class', 'legend');

var
  legendBarWidth = 30,
  legendBarHeight = 10,
  legendOffsetX = 30,
  legendOffsetY = 400;


var date = ["2.99" + "-" + "17.14", "1.91" + "-" + "2.99",
   "1.33" + "-" + "1.91", "0.97" + "-" + "1.33", "0.68" + "-" + "0.97",
    "0.38" + "-" + "0.68", "0" + "-" + "0.38" ];

// draw the legend
d3.select('.legend').selectAll('.legend')
.data(colorScale)
.enter()
  .append('rect')
    .attr('x', legendOffsetX)
    .attr('y', function(d,i) {
      return legendOffsetY + legendBarHeight*i;
    })
    .attr('width', legendBarWidth)
    .attr('height', legendBarHeight)
    .attr('fill', function(d){ return d; });

d3.select('.legend').selectAll('.legend')
.data(colorScale)
.enter()
  .append('text')
  .text(function(d,i){
      var quantizedRange = quantize.invertExtent('q'+i);
      return date[i];
    })
    .attr('x', legendOffsetX+(legendBarWidth*1.25))
    .attr('y', function(d,i){
      return legendOffsetY + (legendBarHeight*0.9) + legendBarHeight*i;
    })
    .attr("font-family", "sans-serif")
    .attr("font-size", "10px")
    .attr("fill", "black");

     
        d3.select('.legend').selectAll('.legend')
        .data(colorScale)
        .enter()
          .append('text')
            .text("CO2 Intensity")
            .attr("class", "caption")
            .attr('x', legendOffsetX)
            .attr('y', legendOffsetY-0.8)
            .attr("font-family", "sans-serif")
            .attr("font-size", "12px")
            .attr("fill", "black");
            




  </script>
   

</body>
</html>